var throughput_data_timer=0;var capacity_data_timer=0;var max_data=20;var throughput_stats_data={};var capacity_stats_data={};var initialized=0;var last_uptime=0;var lastRxCount=[];var lastTxCount=[];var plots=[];$(document).ready(refreshAll);function refreshAll(){if(typeof reloadStatus=="function"){reloadStatus()}reloadThroughput();reloadCapacity()}function reloadThroughput(){if(!document.getElementById("performance")){return}$.ajax({url:"ifstats.cgi",cache:false,dataType:"json",success:updateThroughputGraph});return false}function reloadCapacity(){if(!document.getElementById("performance")){return}$.ajax({url:"afstats.cgi",cache:false,dataType:"json",success:updateCapacityGraph});return false}function normalize_max(e,c){var f=e/c;var d=Math.pow(10,Math.floor(Math.log(f)/Math.LN10));var b=f/d;var a=10;if(b<1.5){a=1}else{if(b<2.25){a=2}else{if(b<3){a=2.5}else{if(b<7.5){a=5}}}}a*=d;if(Math.floor(e/a)*a>=e){return e}return(Math.floor(e/a)+1)*a}function normalize_float(a){if(!a){return 0}if(a>=100){return toFixed(a,0)}if(a>=10){return toFixed(a,1)}return toFixed(a,2)}function formatBPS(c){var b;var a;if(Math.round(c)<1000){b="bps";a=0}else{if(Math.round(c/1000)<1000){c=c/1000;b="kbps";a=1}else{c=c/1000/1000;b="Mbps";a=2}}c=normalize_float(c);return[c,b,a,""+c+b]}function getOptions(b,a){var c={xaxes:[{ticks:max_data,tickFormatter:function(d){return""},min:0,max:max_data-1}],yaxes:[{ticks:8,tickFormatter:function(d){return(d!=0)?Math.round(d*100)/100:b+" 0"},min:0,max:a}],legend:{position:"nw",backgroundOpacity:0.4}};return c}function updateCanvas(b,f,j){if(!document.getElementById(b)){return}var e=f.get_plot_values();var c=formatBPS(e[3][0])[3];var g=formatBPS(e[3][1])[3];var i=[{data:e[0][0],label:"RX"+j+": "+c,color:"#2389C6"},{data:e[0][1],label:"TX"+j+": "+g,color:"#FF0000"}];var a=getOptions(e[1],e[2]);if(plots[b]){var h=plots[b];$.extend(true,h.getOptions(),a);h.setData(i);h.setupGrid();h.draw()}else{plots[b]=$.plot($("#"+b),i,a)}}function PlotData(c,a){this.max_data=a;this.last=new Array(c);this.data=new Array(c);for(var b=0;b<c;++b){this.last[b]=0;this.data[b]=new Array()}this.add_values=function(d){for(var e=0;e<this.data.length;++e){if(this.data[e].length>=this.max_data){this.data[e].shift()}this.data[e].push(d[e])}};this.get_plot_values=function(){var e=100;var h,f;var g,l;var k=[];var d=[];for(h=0;h<this.data.length;++h){d[h]=[];for(f=0;f<this.data[h].length;++f){g=this.data[h][f];if(g>e){e=parseInt(g)}d[h][f]=[f,g]}k[h]=this.data[h][f-1]}l=formatBPS(e);e=normalize_max(l[0],8);if(l[2]>0){for(h=0;h<d.length;++h){for(f=0;f<d[h].length;++f){d[h][f][1]/=Math.pow(1000,l[2])}}}return[d,l[1],e,k]}}function initGraphs(c){var b={};var a={};b.canvas="canvas0";b.data=new PlotData(2,max_data);a.canvas="canvas1";a.data=new PlotData(2,max_data);$("#performance > tbody").append('<tr><td class="graph-label"><span id="label0"></span></td><td class="graph-label"><span id="label1"></span></td></tr><tr><td><div class="graph-border"><div id="canvas0" class="graph-canvas"></div></div></td><td><div class="graph-border"><div id="canvas1" class="graph-canvas"></div></div></td></tr>');throughput_stats_data[c]=b;$("#label0").text("Throughput");capacity_stats_data[c]=a;$("#label1").text("Capacity");initialized=1}function updateThroughputGraph(k){var g;var b,c;if(!k){if(typeof reloadStatus=="function"){reloadStatus()}else{window.location.reload()}return}if(!initialized){initGraphs(k.interfaces[0].ifname)}g=k.host.uptimehires;if(g>last_uptime){for(var d=0;d<k.interfaces.length;++d){var f=k.interfaces[d];if(throughput_stats_data[f.ifname]){var e=throughput_stats_data[f.ifname];if(last_uptime){var h,j,a;h=g-last_uptime;j=(f.stats.rx_bytes-lastRxCount);a=(f.stats.tx_bytes-lastTxCount);b=(j>=0?j:j+Math.pow(2,32))/h;c=(a>=0?a:a+Math.pow(2,32))/h;e.data.add_values([c*8,b*8])}updateCanvas(e.canvas,e.data,"");lastRxCount[d]=f.stats.rx_bytes;lastTxCount[d]=f.stats.tx_bytes}}}throughput_data_timer=setTimeout("reloadThroughput()",last_uptime?5000:500);last_uptime=g}function updateCapacityGraph(c){if(!c){if(typeof reloadStatus=="function"){reloadStatus()}else{window.location.reload()}return}if(!initialized){initGraphs(c.interfaces[0].ifname)}for(var b=0;b<c.interfaces.length;++b){var d=c.interfaces[b];if(capacity_stats_data[d.ifname]){var a=capacity_stats_data[d.ifname];a.data.add_values([d.stats.rxcapacity,d.stats.txcapacity]);updateCanvas(a.canvas,a.data,"")}}capacity_data_timer=setTimeout("reloadCapacity()",500)};