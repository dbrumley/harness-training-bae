(function(){var b=this.ubnt||(this.ubnt={}),a=b.net||(b.net={});a.network=function(f){var c=function(j){return{netconfObj:j,enabled:function(){if(arguments[0]!==undefined){this.netconfObj.enabled(arguments[0])}return this.netconfObj.enabled()},getDevname:function(){return this.netconfObj.getDevname()},getNatDevname:function(){return this.ipMode==="Pppoe"?"ppp+":j.devname},setDevname:function(k){this.netconfObj.devname=k;if(this.dhcpcObj){this.dhcpcObj.devname=k}if(this.pppObj){this.pppObj.devname=k}if(this.dhcpdObj){this.dhcpdObj.devname=k}if(this.dhcpRelayClientObj){this.dhcpRelayClientObj.devname=k}this.updateNatDevname()},updateNatDevname:function(){if(this.masqObj){this.masqObj.devname=this.getNatDevname()}if(this.dmzObj){this.dmzObj.devname=this.getNatDevname()}if(this.mgmtObj){this.mgmtObj.devname=this.getNatDevname()}},getIpMode:function(){var l=f.get("dhcpc"),k=f.get("ppp");if(!this.dhcpcObj){this.dhcpcObj=l.findByDevname(j.devname)}if(!this.pppObj){this.pppObj=k.findByDevname(j.devname)}this.ipMode="Static";if(l.enabled()&&this.dhcpcObj&&this.dhcpcObj.enabled()){this.ipMode="Dhcpc"}else{if(k.enabled()&&this.pppObj&&this.pppObj.enabled()){this.ipMode="Pppoe"}}return this.ipMode},setIpMode:function(o,k){var n=f.get("iptables.sys.tcpmss",false);this.ipMode=o;switch(o){case"Static":if(this.dhcpcObj!==undefined&&this.dhcpcObj.enabled()){this.dhcpcObj.enabled(false)}if(this.pppObj!==undefined&&this.pppObj.enabled()){this.pppObj.enabled(false);f.get("ppp").enabled(false)}if(n){n.enabled(false)}break;case"Dhcpc":var m=f.get("dhcpc");m.enabled(true);if(this.dhcpcObj===undefined){var q=m.find({devname:j.devname});if(q.length>0){this.dhcpcObj=q[0];this.dhcpcObj.devname=j.devname}else{this.dhcpcObj=m.create(j.devname,"192.168.1.20","255.255.255.0",true);m.add(this.dhcpcObj)}}this.dhcpcObj.enabled(true);this.netconfObj.ip="0.0.0.0";if(this.pppObj!==undefined&&this.pppObj.enabled()){this.pppObj.enabled(false);f.get("ppp").enabled(false)}if(k===true){f.get("route.1").enabled(false)}if(n){n.enabled(false)}break;case"Pppoe":var l=f.get("ppp");l.enabled(true);if(this.pppObj===undefined){var p=l.find({});if(p.length>0){this.pppObj=p[0];this.pppObj.devname=j.devname}else{this.pppObj=l.create(j.devname,"","","",false,1492,1492,true);l.add(this.pppObj)}}else{this.pppObj.enabled(true)}f.get("iptables.sys.tcpmss").enabled(true);j.ip="0.0.0.0";j.netmask="255.255.255.255";if(this.dhcpcObj!==undefined&&this.dhcpcObj.enabled()){this.dhcpcObj.enabled(false)}if(k===true){f.get("route.1").enabled(false)}break}this.updateNatDevname()},setIp:function(l,k){this.netconfObj.ip=l;this.netconfObj.netmask=k},getGateway:function(){var l="",k=f.get("route.1");if(k.ip==="0.0.0.0"){l=k.gateway}return l},setGateway:function(m){var l=f.get("route"),k=f.route.create("0.0.0.0","0",m,"",true);k.devname=this.netconfObj.devname;l.replace(0,k);l.enabled(true)},getDns:function(k){return f.get("resolv.nameserver."+(k+1)).ip},getInbandManagementEnabled:function(){var l=f.bridge.findByDevname("br0");if(l){var m=l.port.findByDevname("air0");var k=f.netconf.findByDevname("air0");if(m){return(m.status=="enabled")}}return false},setInBandManagementEnabled:function(m){var l=f.bridge.findByDevname("br0");if(l){var n=l.port.findByDevname("air0");var k=f.netconf.findByDevname("air0");if(n==null){n=l.addPort("air0")}if(n!=null){n.status=m?"enabled":"disabled"}if(k!=null){k.up=m?"enabled":"disabled";k.status=m?"enabled":"disabled";k.role="bridge_port"}return true}else{return false}},setDns:function(l,m){var n=f.get("resolv.nameserver"),k=n.create(m,m.length>0);n.replace(l,k);n.enabled(true)},getDhcpcFallback:function(){return this.dhcpcObj&&this.dhcpcObj.fallback?this.dhcpcObj.fallback:((f.netmode=="bridge"||f.netmode=="airfiber")?"192.168.1.20":"192.168.10.1")},getDhcpcFallbackNetmask:function(){return this.dhcpcObj&&this.dhcpcObj.fallback_netmask?this.dhcpcObj.fallback_netmask:"255.255.255.0"},setDhcpcFallback:function(l,k){this.dhcpcObj.fallback=l;this.dhcpcObj.fallback_netmask=k},getPppoe:function(k){if(this.pppObj&&this.pppObj[k]){return this.pppObj[k]}else{return{fallback:"192.168.10.1",fallback_netmask:"255.255.255.0",mtu:1492,mru:1492}[k]}},setPppoe:function(k){$.extend(this.pppObj,k)},natEnabled:function(){var l=f.get("iptables.sys.masq");if(!this.masqObj){this.masqObj=l.findByDevname(this.getNatDevname())}if(arguments[0]!==undefined){if(this.masqObj){this.masqObj.enabled(arguments[0])}else{if(arguments[0]){this.masqObj=l.add(l.create(this.getNatDevname(),true))}}if(arguments[0]){f.get("iptables").enabled(true);f.get("iptables.sys").enabled(true);l.enabled(true)}else{var k=true;l.each(true,function(m,n){k=false;return false});if(k){l.enabled(false)}}}else{return l.enabled()&&!!this.masqObj&&this.masqObj.enabled()}},natProtocolEnabled:function(p,l){var o=f.get("system.modules.blacklist"),n="ip_.*_"+p,m=o.find({expr:n});if(l!=undefined){if(!m.length){if(!l){m.push(o.add(o.create(n,true)))}}else{m[0].enabled(!l)}if(!l){o.enabled(true)}else{var k=true;o.each(true,function(q,r){k=false;return false});if(k){o.enabled(false)}}}return !(o.enabled()&&m.length&&m[0].enabled())},getDhcpServer:function(){var n=f.get("dhcpd"),k=f.get("dhcprelay"),o=f.get("dhcprelay.client"),m=f.get("dhcprelay.server"),p=n.find({devname:j.devname}),l=o.find({devname:j.devname});this.dhcpd=n;this.dhcpRelay=k;this.dhcpRelayClient=o;this.dhcpRelayServer=m;if(p!=undefined&&p.length){this.dhcpdObj=p[0]}if(l!=undefined&&l.length){this.dhcpRelayClientObj=l[0]}if(n.enabled()&&this.dhcpdObj&&this.dhcpdObj.enabled()){return"Enabled"}else{if(k.enabled()&&this.dhcpRelayClientObj&&this.dhcpRelayClientObj.enabled()){this.dhcpRelayServerObj=m.objs[this.dhcpRelayClientObj.getIdx()];return"Relay"}else{return"Disabled"}}},setDhcpServer:function(k){switch(k){case"Disabled":if(this.dhcpdObj){this.dhcpdObj.enabled(false)}if(this.dhcpRelayClientObj){this.dhcpRelayClientObj.enabled(false)}if(this.dhcpRelayServerObj){this.dhcpRelayServerObj.enabled(false)}break;case"Enabled":this.dhcpd.enabled(true);if(this.dhcpRelayClientObj){this.dhcpRelayClientObj.enabled(false)}if(this.dhcpRelayServerObj){this.dhcpRelayServerObj.enabled(false)}if(this.dhcpdObj==undefined){this.dhcpdObj=this.dhcpd.create(j.devname,true);this.dhcpd.add(this.dhcpdObj)}else{this.dhcpdObj.enabled(true)}break;case"Relay":if(this.dhcpdObj){this.dhcpdObj.enabled(false)}this.dhcpRelay.enabled(true);if(this.dhcpRelayClientObj==undefined){this.dhcpRelayClientObj=this.dhcpRelayClient.create(j.devname,true);this.dhcpRelayClient.add(this.dhcpRelayClientObj);this.dhcpRelayServerObj=this.dhcpRelayServer.create("",true);this.dhcpRelayServer.objs[this.dhcpRelayClientObj.getIdx()]=this.dhcpRelayServerObj}else{this.dhcpRelayClientObj.enabled(true);this.dhcpRelayServerObj.enabled(true)}break}},getDhcpdAttr:function(k){if(this.dhcpdObj&&this.dhcpdObj[k]){return this.dhcpdObj[k]}else{return{start:"192.168.1.2",end:"192.168.1.254",netmask:"255.255.255.0",lease_time:"600",dnsproxy:"enabled"}[k]}},dmzEnabled:function(){var l=f.get("iptables.sys.dmz");if(!this.dmzObj){this.dmzObj=l.findByDevname(this.getNatDevname())}if(arguments[0]!==undefined){if(this.dmzObj){this.dmzObj.enabled(arguments[0])}else{if(arguments[0]){this.dmzObj=l.add(l.create(this.getNatDevname(),true))}}if(arguments[0]){f.get("iptables").enabled(true);f.get("iptables.sys").enabled(true);l.enabled(true)}else{var k=true;l.each(true,function(n,m){k=false;return false});if(k){l.enabled(false)}}}else{return l.enabled()&&!!this.dmzObj&&this.dmzObj.enabled()}},dmzMgmtPortsEnabled:function(){if(arguments[0]!==undefined){var k=this.dmzObj.except;k.objs=[];k.enabled(!arguments[0]);if(!arguments[0]){k.add(k.create(8,"ICMP",true));k.add(k.create(9,"UDP",true));k.add(k.create(f.airview&&f.airview.tcp_port?f.airview.tcp_port:18888,"TCP",true));if(f.httpd&&f.httpd.enabled()){k.add(k.create(f.httpd.port?f.httpd.port:80,"TCP",true))}if(!f.sshd||f.sshd.enabled()){k.add(k.create(f.sshd.port?f.sshd.port:22,"TCP",true))}if(f.httpd&&f.httpd.https&&f.httpd.https.enabled()){k.add(k.create(f.httpd.https.port?f.httpd.https.port:443,"TCP",true))}if(f.telnetd&&f.telnetd.enabled()){k.add(k.create(f.telnetd.port?f.telnetd.port:23,"TCP",true))}if(f.snmp&&f.snmp.enabled()){k.add(k.create(161,"UDP",true))}if(!f.discovery||f.discovery.enabled()){k.add(k.create(1001,"TCP",true))}}}else{return !(this.dmzObj&&this.dmzObj.except&&this.dmzObj.except.enabled()&&this.dmzObj.except.find({status:"enabled"}))}},blockMgmt:function(){var k=f.get("iptables.sys.mgmt");if(!this.mgmtObj){this.mgmtObj=k.findByDevname(this.getNatDevname())}if(arguments[0]!==undefined){if(this.mgmtObj){this.mgmtObj.enabled(arguments[0])}else{if(arguments[0]){this.mgmtObj=k.add(k.create(this.getNatDevname(),true))}}if(arguments[0]){f.get("iptables").enabled(true);f.get("iptables.sys").enabled(true);k.enabled(true)}else{var l=true;k.each(true,function(n,m){l=false;return false});if(l){k.enabled(false)}}}else{return k.enabled()&&!!this.mgmtObj&&this.mgmtObj.enabled()}},getMaxMtu:function(){var n=1524,p=this.getDevname(),l=f.bridge.findByDevname(p),r=function o(v){var m=1524;if(v.indexOf("eth")==0){var u=f.get("vlan");if(u.isVlan(v)){m=o(u.getParent(v))}else{var w=parseInt(v.substr(3))+1,t=g_board.get("board.phy."+w,false);if(t){m=t.maxmtu}}}else{if(v.indexOf("ath")==0){m=2099}}return m};if(l){var s=l.getPorts();for(var q=0;q<s.length;q++){var k=r(s[q]);if(q==0||k<n){n=k}}}else{n=r(this.netconfObj.getDevname())}return n},setMtu:function(o){var k=this.netconfObj.getDevname(),m=function l(r){var q=f.get("vlan"),p=f.netconf.findByDevname(r);if(q.isVlan(r)){max=l(q.getParent(r))}if(p){p.mtu=o}};m(k);if(k.indexOf("br")==0){var n=f.bridge.findByDevname(k,true);if(n){n.port.each(true,function(p,q){m(q.getDevname())})}}},upnpdEnabled:function(l){var n=f.get("upnpd"),m=f.get("upnpd.listening");if(!this.upnpdListeningObj){var k=m.find({ip:this.netconfObj.ip});if(k.length){this.upnpdListeningObj=k[0]}}if(l!==undefined){if(l||(!l&&this.upnpdListeningObj)){if(this.upnpdListeningObj){this.upnpdListeningObj.enabled(l);this.upnpdListeningObj.ip=this.netconfObj.ip;this.upnpdListeningObj.netmask=this.netconfObj.netmask}else{this.upnpdListeningObj=m.add(m.create(this.netconfObj.ip,this.netconfObj.netmask,l))}}n.enabled(m.find({status:"enabled"}).length>0);return l}return n.enabled()&&this.upnpdListeningObj&&this.upnpdListeningObj.enabled()}}},i={lan:{},interfaces:[],freeIfc:[],isBridge:f.netmode=="bridge",isAirfiber:f.netmode=="airfiber",removeNonExistingIfc:function(){var l=["vlan","dhcpc","dhcpd","dhcprelay.server","dhcpcrelay.client","dnsmasq","ebtables.sys.arpnat","ebtables.sys.eap","ebtables.sys.vlan","iptables.sys.portfw","iptables.sys.dmz","iptables.sys.mgmt","iptables.sys.masq","netconf","ppp","qos.uplink","qos.downlink","radvd","tshaper"],k=Array.prototype.slice.call(this.interfaces,0),j=function(m){return $.inArray(m.devname,k)!=-1};if(f.ppp&&f.ppp.objs.length&&f.ppp.objs[0].enabled()){k.push("ppp+")}$.each(l,function(m,o){var n=f.get(o,false);if(n){n.objs=n.grep(j)}});if(f.bridge){f.bridge.each(function(m,n){if(n.port){n.port.objs=n.port.grep(j)}})}$.each(["ebtables","iptables"],function(n,o){var m=f.get(o,false);if(m){m.objs=m.grep(function(r){var q=r.cmd.split(" "),p=$.inArray("-i",q);if(p!=-1){return $.inArray(q[p+1],k)!=-1}else{return true}})}})},removeDuplicates:function(){var j=["dhcpc","dhcpd"];$.each(j,function(l,o){var n=f.get(o,false);if(n&&n.objs&&n.objs.length>1){var m=[],k=[];n.each(function(p,q){if($.inArray(q.devname,m)==-1){m.push(q.devname);k.push(q)}});n.objs=k}})},addIfc:function(k){var m=f.netconf,l=m.findByDevname(k);if(!l){var j=m.create(k,"");m.add(j)}else{if(!l.enabled()){l.enabled(true)}}this.interfaces.push(k);this.interfaces.sort();this.trigger("ifcAdded",k);this.unuseIfc(k)},removeIfc:function(j){var l=f.netconf,k=l.findByDevname(j);if(k){var m=$.inArray(j,this.interfaces);if(k.role=="mlan"||k.role=="wan"){k.enabled(false)}else{l.remove(k)}if(m!=-1){this.interfaces.splice(m,1)}this.useIfc(j);this.trigger("ifcRemoved",j)}},addVlan:function(k){var l=f.get("vlan");l.enabled(true);if($.inArray(k.getDevname(),f.bridge.getPorts())!=-1){var j=f.get("ebtables.sys.vlan");j.add($.extend({},k));j.enabled(true)}l.add(k);this.addIfc(k.getFullDevname())},removeVlan:function(k){var j=f.get("ebtables.sys.vlan"),l=j.find({devname:k.devname,id:k.id});$.each(l,function(m,n){j.remove(n)});j.enabled(j.objs.length);f.vlan.remove(k);this.removeIfc(k.getFullDevname())},addBridge:function(){var j=f.bridge.add();this.addIfc(j.devname);return j},removeBridge:function(j){var l=j.getPorts(),k=this;$.each(l,function(m,n){k.removeBridgePort(j,n)});f.bridge.remove(j);this.removeIfc(j.devname)},availableIfcsForBridgePors:function(){var k=f.bridge.getPorts(),j=!this.isBridge&&!this.isAirfiber&&this.wan.enabled()?this.wan.getDevname():"",l=this.mlan.enabled()?this.mlan.getDevname():"";return $.grep(this.freeIfc,function(m){return m.indexOf("br")!=0&&$.inArray(m,k)==-1&&m!=j&&m!=l})},addBridgePort:function(o,t){var j=o.addPort(t);if(j!=null){var l=f.netconf.findByDevname(t);if(l){l.clear()}if(t.indexOf("ath")!=-1){var q=f.get("ebtables.sys.arpnat"),p=q.findByDevname(t),k=t.indexOf(".")==-1;if(p){p.enabled(true)}else{q.add(q.create(t,true))}if(k){var n=f.get("ebtables.sys.eap"),r=n.findByDevname(t);if(r){r.enabled(true)}else{n.add(n.create(t,true))}f.get("ebtables.sys.eap").enabled(true)}}if(t.indexOf(".")==-1){var m=f.vlan.find({devname:t}),s=f.get("ebtables.sys.vlan");$.each(m,function(v,u){s.add($.extend({},u));s.enabled(true)})}this.useIfc(t,"bridge_port");this.trigger("bridgePortAdded",t);return j}},removeBridgePort:function(l,m){if(m.indexOf("ath")!=-1){var k=f.get("ebtables.sys.arpnat"),p=k.findByDevname(m),o=f.get("ebtables.sys.eap"),q=o.findByDevname(m);if(p){k.remove(p)}if(q){o.remove(q);o.enabled(o.objs.length)}}if(m.indexOf(".")==-1){var n=f.vlan.find({devname:m}),j=f.get("ebtables.sys.vlan");$.each(n,function(s,r){var t=j.find({devname:r.devname,id:r.id});$.each(t,function(u,v){j.remove(v)});j.enabled(j.objs.length)})}l.removePort(m);this.unuseIfc(m);this.trigger("bridgePortRemoved",m)},addLan:function(l){var j=f.netconf.findByDevname(l);if(j){var k=c(j);i.lan[l]=k;this.useIfc(l,"lan");return k}},removeLan:function(k){var j=i.lan[k];j.setDhcpServer("Disabled");j.netconfObj.role="";j.netconfObj.clear();delete i.lan[k];this.unuseIfc(k)},setWanIfc:function(k){var j=this.wan.getDevname();if(j!=k){var o=f.netconf.find({devname:j,role:""}),m=f.netconf.find({devname:k,role:""}),l=this.wan.netconfObj.alias;this.wan.setDevname(k);if(m.length){m[0].enabled(false);this.wan.netconfObj.alias=m[0].alias}if(o.length){o[0].enabled(true);o[0].alias=l}else{var p=f.netconf.add(f.netconf.create(j,""));p.alias=l}this.unuseIfc(j);this.useIfc(k);this.trigger("wanIfcChanged",k)}},setMlanIfc:function(l){var j=this.mlan.enabled(),k=this.isBridge||this.isAirfiber||l!=this.wan.getDevname();prevDevname=this.mlan.getDevname();if(j!=k||prevDevname!=l){var p=f.netconf.find({devname:prevDevname,role:""}),o=f.netconf.find({devname:l,role:""}),m=this.mlan.netconfObj.alias;this.mlan.enabled(k);this.mlan.setDevname(l);if(j&&prevDevname!=l){if(p.length){p[0].enabled(true);p[0].alias=m}else{var q=f.netconf.add(f.netconf.create(prevDevname,""));q.alias=m}this.unuseIfc(prevDevname)}if(k){if(o.length){o[0].enabled(false);this.mlan.netconfObj.alias=o[0].alias}this.useIfc(l)}this.trigger("mlanIfcChanged",l)}return k},swapWanLanIfcs:function(k){var j=this.wan.getDevname();if(k in g_net.lan){var l=g_net.lan[k];g_net.wan.setDevname(k);l.setDevname(j);delete g_net.lan[k];g_net.lan[j]=l}this.trigger("wanIfcChanged",k)},useIfc:function(k,m){var l=$.inArray(k,this.freeIfc);if(l!=-1){if(m){var j=f.netconf.find({devname:k,role:""});if(j.length){j[0].role=m}}this.freeIfc.splice(l,1);this.trigger("ifcUsed",k)}},unuseIfc:function(k){var j=f.netconf.find({devname:k});$.each(j,function(m,l){if(l.role!="mlan"&&l.role!="wan"){l.role=""}});this.freeIfc.push(k);this.freeIfc.sort();this.trigger("ifcUnused",k)},enableIfc:function(l,k){var j=f.netconf.findByDevname(l);if(j&&j.enabled()!=k){var m=$.inArray(l,this.freeIfc);j.enabled(k);this.trigger(k?"ifcEnabled":"ifcDisabled",l)}},getIpAliases:function(){var j=[];f.netconf.each(true,function(l,k){if(k.alias){k.alias.each(function(m,n){j.push({devname:k.devname,aliasObjRef:n})})}});return j},switchNetmode:function(m){var l=["bridge","dhcpc","dhcpd","dhcprelay","dnsmasq","ebtables","igmpproxy","iptables","netconf","ppp","resolv.nameserver","route","route6","tshaper"],j=b.cfg.parse(b.net.defaultCfg[m]),k=$.extend({},f);$.each(l,function(n,o){if(k[o]){delete k[o]}});$.extend(k,j);if(m=="router"&&!g_apmode){k.netconf.objs[0].devname="ath0";k.netconf.objs[1].devname="eth0";k.dhcpc.objs[0].devname="ath0"}return k},enableIfExist:function(k,j){var l=f.get(k,false);if(l){l.enabled(j)}},updateStatuses:function(){var x=f.bridge&&f.bridge.objs.length;this.enableIfExist("bridge",x);this.enableIfExist("ebtables",x);this.enableIfExist("ebtables.sys",x);if(x){if(f.ebtables&&f.ebtables.sys){var m=f.get("radio.1").mode,j=f.get("wireless.1.wds").enabled(),y=f.get("wireless.1.macclone"),p=m.toLowerCase()=="managed",u=p&&!j&&y!="enabled";eap=false;if(p){var t,l,q;if((t=f.get("wpasupplicant",false))&&t.enabled()&&(l=f.get("wpasupplicant.device.1",false))&&l.enabled()&&(q=f.get("wpasupplicant.profile.1.network.1.proto.1",false))&&q.mode!=0){eap=true}}else{var k,w,s;if((k=f.get("aaa",false))&&k.enabled()&&(w=f.get("aaa.1",false))&&w.enabled()&&(s=f.get("aaa.1.wpa",false))&&s.mode!=0){eap=true}}f.get("ebtables.sys.arpnat").enabled(u);f.get("ebtables.sys.eap").enabled(eap)}}else{this.enableIfExist("ebtables",false)}f.get("vlan").each(function(A,z){var C=f.netconf.findByDevname(z.devname,true),B=f.netconf.findByDevname(z.getFullDevname(),true);if(C&&B&&C.mtu<B.mtu){B.mtu=C.mtu}});if(!this.isBridge&&!this.isAirfiber){var n=f.get("upnpd"),v=f.get("iptables"),o=f.get("iptables.sys"),r=f.get("iptables.sys.upnpd");if(n.enabled()){n.devname=this.wan.getNatDevname();v.enabled(true);o.enabled(true);r.enabled(true);r.devname=n.devname}else{r.enabled(false)}}},simpleCfgModeApplicable:function(){var q=true;if(this.getIpAliases().length){q=false}if(q&&f.tshaper&&f.tshaper.enabled()){q=false}if(q){var m=(g_net.isBridge||g_net.isAirfiber)?"ebtables":"iptables",n=f.get(m+".sys.fw",false);if(n&&n.enabled()){q=false}}if(q){var k=f.get("vlan",false),j=k?k.objs.length:0,p=f.get("bridge",false),o=p?p.objs.length:0,l=f.netconf.find({role:"lan"}).length;switch(g_cfg.netmode){case"airfiber":case"bridge":if(this.getMgmtVlan()){if(o>2||j>f.getInterfaces(["board"])){q=false}}else{if(o>1||j>0){q=false}}break;case"router":if(o>0||j>0||l!=1){q=false}break;case"soho":if(o>1||j>0||l!=1){q=false}break}}return q},advancedCfgMode:function(){var j="gui.network.advanced",l=f.get(j,false),k=false;if(l){k=l.enabled()}if(!k&&!this.simpleCfgModeApplicable()){k=true}return k},setAdvancedCfgMode:function(k){var j="gui.network.advanced";f.get(j).enabled(k)},getMgmtVlan:function(){var n=undefined,j=f.bridge.findByDevname("br1"),k=f.get("vlan",false);if(j&&k){var m=j.getPorts();if(m.length==f.getInterfaces(["board"]).length&&k.isVlan(m[0])){n=k.getId(m[0]);for(var l=1;l<m.length;l++){if(n!=k.getId(m[l])){n=undefined;break}}}}return n},setMgmtVlan:function(p){if(p&&!f.vlan.create("eth0",p,"").valid()){return}var k=f.bridge.findByDevname("br1");if(k){var o=o=k.getPorts();this.setMlanIfc("br0");this.removeBridge(k);for(var m=0;m<o.length;m++){this.removeVlan(f.vlan.findByFullDevname(o[m]))}}var k=f.bridge.findByDevname("br1");if(k){this.removeBridge(k)}if(p){var o=f.getInterfaces(["board"]),l=f.get("vlan");k=this.addBridge();for(var m=0;m<o.length;m++){var j=l.create(o[m],p,"For Management",true);this.addVlan(j);this.addBridgePort(k,j.getFullDevname())}}var n=f.bridge.findByDevname("br0");if(n){n.status=p?"disabled":"enabled"}this.setMlanIfc(p?"br1":"br0")},DEFAULT_MTU:1500,DEFAULT_MAX_MTU:1524,DEFAULT_ATH_MAX_MTU:2099,getPhyMtu:function(l){phyMtu=this.DEFAULT_MAX_MTU;if(l.indexOf("eth")==0){var j=parseInt(l.substr(3))+1;var k=g_board.get("board.phy."+j,false);if(k){phyMtu=k.maxmtu}}else{if(l.indexOf("ath")==0){phyMtu=this.DEFAULT_ATH_MAX_MTU}}return phyMtu},getMtu:function(j){var k=f.netconf.findByDevname(j,true);return parseInt(k?k.mtu:this.DEFAULT_MTU)},getMaxMtu:function(n){var p=this.DEFAULT_MAX_MTU;var l=f.get("vlan");if(n.indexOf("eth")==0||n.indexOf("air")==0){p=!l.isVlan(n)?this.getPhyMtu(n):this.getMtu(l.getParent(n))}else{var k=f.bridge.findByDevname(n);if(k){var q=k.getPorts();for(var o=0;o<q.length;o++){var j=this.getMtu(q[o]);if(l.isVlan(q[o])&&this.getMaxMtu(q[o])<j){j=this.getMaxMtu(q[o])}if(o==0||j<p){p=j}}}}return p}},d=f.bridge?f.bridge.getPorts():[];$.extend(i,b.core.events);i.interfaces=f.getInterfaces(["board","bridge","vlan"]);i.removeNonExistingIfc();i.removeDuplicates();$.each(i.interfaces,function(k,l){var j=f.netconf.find({devname:l}),n=$.inArray(l,d)!=-1,m=true;if(j.length){$.each(j,function(p,o){var q=o.role;if(o.enabled()){if(m){switch(q){case"wan":if(i.isBridge){o.enabled(false)}else{m=false}break;case"mlan":m=false;break;case"lan":if(i.isBridge){if(n){o.role="bridge_port";m=false}else{o.role=""}}else{m=false}break;case"bridge_port":if(n){m=false}else{if(o.devname!="air0"){o.role=""}}break;default:if(n){o.role="bridge_port";m=false}else{o.role=""}break}}else{f.netconf.remove(o)}}else{if(q!="mlan"&&q!="bridge_port"){o.role=""}}});if(m&&n){f.netconf.add(f.netconf.create(l,"bridge_port"))}}else{f.netconf.add(f.netconf.create(l,n?"bridge_port":""))}if(m){i.freeIfc.push(l)}});f.netconf.each(function(k,j){var l=j.role;if(l==="wan"||l==="mlan"){if(i[l]===undefined){i[l]=c(j)}else{j.enabled(false)}}else{if(l==="lan"){i[l][j.getDevname()]=c(j)}}});if(i.wan===undefined&&!i.isBridge&&!i.isAirfiber){var e="eth0";i.wan=c(f.netconf.add(f.netconf.create(e,"wan")))}if(i.mlan===undefined){var h=(i.isBridge||i.isAirfiber)?"br0":i.wan.getDevname();if(i.isBridge||i.isAirfiber){var g=f.bridge.getInterfaces();if(!(h in g)){if(g.length){h=g[0]}else{h="eth0"}}}i.mlan=c(f.netconf.add(f.netconf.create(h,"mlan")));if(!i.isBridge&&!i.isAirfiber){i.mlan.enabled(false)}}f.ebtables.enabled(false);return i};a.defaultCfg={bridge:"netmode=bridge\n\nbridge.status=enabled\nbridge.1.devname=br0\nbridge.1.fd=1\nbridge.1.port.1.devname=eth0\nbridge.1.port.2.devname=ath0\nbridge.1.port.3.devname=eth1\n\nnetconf.status=enabled\nnetconf.1.status=enabled\nnetconf.1.devname=eth0\nnetconf.1.ip=0.0.0.0\nnetconf.1.netmask=255.255.255.0\nnetconf.1.up=enabled\nnetconf.1.promisc=enabled\n\nnetconf.2.status=enabled\nnetconf.2.devname=ath0\nnetconf.2.ip=0.0.0.0\nnetconf.2.netmask=255.255.255.0\nnetconf.2.up=enabled\nnetconf.2.promisc=enabled\nnetconf.2.allmulti=enabled\n\nnetconf.3.status=enabled\nnetconf.3.devname=br0\nnetconf.3.ip=192.168.1.20\nnetconf.3.netmask=255.255.255.0\nnetconf.3.up=enabled\nnetconf.3.role=mlan\n\nnetconf.4.status=enabled\nnetconf.4.devname=eth1\nnetconf.4.ip=0.0.0.0\nnetconf.4.netmask=255.255.255.0\nnetconf.4.up=enabled\nnetconf.4.promisc=enabled\n\nroute.status=enabled\nroute.1.status=enabled\nroute.1.devname=br0\nroute.1.gateway=192.168.1.1\nroute.1.ip=0.0.0.0\nroute.1.netmask=0\n\nebtables.status=enabled\nebtables.sys.status=enabled\n\nebtables.sys.arpnat.status=disabled\nebtables.sys.arpnat.1.status=enabled\nebtables.sys.arpnat.1.devname=ath0\n\nebtables.sys.eap.status=disabled\nebtables.sys.eap.1.status=enabled\nebtables.sys.eap.1.devname=ath0\n",router:"netmode=router\n\nnetconf.status=enabled\nnetconf.1.status=enabled\nnetconf.1.devname=eth0\nnetconf.1.ip=0.0.0.0\nnetconf.1.netmask=255.255.255.0\nnetconf.1.promisc=enabled\nnetconf.1.up=enabled\nnetconf.1.role=wan\n\nnetconf.2.status=enabled\nnetconf.2.devname=ath0\nnetconf.2.ip=192.168.1.1\nnetconf.2.netmask=255.255.255.0\nnetconf.2.up=enabled\nnetconf.2.promisc=enabled\nnetconf.2.role=lan\n\nbridge.status=disabled\n\ndhcpc.status=enabled\ndhcpc.1.status=enabled\ndhcpc.1.devname=eth0\ndhcpc.1.fallback=192.168.10.1\n",soho:"netmode=soho\n\nbridge.status=enabled\nbridge.1.devname=br0\nbridge.1.fd=1\nbridge.1.port.1.devname=ath0\nbridge.1.port.2.devname=eth1\n\nnetconf.status=enabled\nnetconf.1.status=enabled\nnetconf.1.devname=eth0\nnetconf.1.ip=0.0.0.0\nnetconf.1.netmask=255.255.255.0\nnetconf.1.promisc=enabled\nnetconf.1.up=enabled\nnetconf.1.role=wan\n\nnetconf.2.status=enabled\nnetconf.2.devname=ath0\nnetconf.2.ip=0.0.0.0\nnetconf.2.netmask=255.255.255.0\nnetconf.2.up=enabled\nnetconf.2.promisc=enabled\n\nnetconf.3.status=enabled\nnetconf.3.devname=br0\nnetconf.3.ip=192.168.1.1\nnetconf.3.netmask=255.255.255.0\nnetconf.3.up=enabled\nnetconf.3.role=lan\n\nnetconf.4.devname=eth1\nnetconf.4.ip=0.0.0.0\nnetconf.4.netmask=255.255.255.0\nnetconf.4.up=enabled\n\ndhcpd.status=enabled\ndhcpd.1.status=enabled\ndhcpd.1.devname=br0\ndhcpd.1.dnsproxy=enabled\ndhcpd.1.lease_time=600\ndhcpd.1.netmask=255.255.255.0\ndhcpd.1.start=192.168.1.2\ndhcpd.1.end=192.168.1.254\n\ndhcpc.status=enabled\ndhcpc.1.status=enabled\ndhcpc.1.devname=eth0\ndhcpc.1.fallback=192.168.10.1\n\niptables.status=enabled\niptables.sys.status=enabled\niptables.sys.masq.status=enabled\niptables.sys.masq.1.status=enabled\niptables.sys.masq.1.devname=eth0\niptables.sys.mgmt.status=enabled\niptables.sys.mgmt.1.status=enabled\niptables.sys.mgmt.1.devname=eth0\n\nebtables.status=enabled\nebtables.sys.status=enabled\n\nebtables.sys.arpnat.status=disabled\nebtables.sys.arpnat.1.status=enabled\nebtables.sys.arpnat.1.devname=ath0\n\nebtables.sys.eap.status=disabled\nebtables.sys.eap.1.status=enabled\nebtables.sys.eap.1.devname=ath0\n","3g":"netmode=3g\n\nbridge.status=enabled\nbridge.1.devname=br0\nbridge.1.fd=1\nbridge.1.port.1.devname=ath0\nbridge.1.port.2.devname=eth0\nbridge.1.port.3.devname=eth1\n\nnetconf.status=enabled\nnetconf.1.status=enabled\nnetconf.1.devname=eth0\nnetconf.1.ip=0.0.0.0\nnetconf.1.netmask=255.255.255.0\nnetconf.1.promisc=enabled\nnetconf.1.up=enabled\n\nnetconf.2.status=enabled\nnetconf.2.devname=ath0\nnetconf.2.ip=0.0.0.0\nnetconf.2.netmask=255.255.255.0\nnetconf.2.up=enabled\nnetconf.2.promisc=enabled\n\nnetconf.3.status=enabled\nnetconf.3.devname=br0\nnetconf.3.ip=192.168.1.1\nnetconf.3.netmask=255.255.255.0\nnetconf.3.up=enabled\nnetconf.3.role=lan\n\nnetconf.4.devname=eth1\nnetconf.4.ip=0.0.0.0\nnetconf.4.netmask=255.255.255.0\nnetconf.4.up=enabled\n\ndhcpd.status=enabled\ndhcpd.1.status=enabled\ndhcpd.1.devname=br0\ndhcpd.1.dnsproxy=enabled\ndhcpd.1.lease_time=600\ndhcpd.1.netmask=255.255.255.0\ndhcpd.1.start=192.168.1.2\ndhcpd.1.end=192.168.1.254\n\niptables.status=enabled\niptables.sys.status=enabled\niptables.sys.masq.status=enabled\niptables.sys.masq.1.status=enabled\niptables.sys.masq.1.devname=ppp+\n\nebtables.status=enabled\nebtables.sys.status=enabled\n\nebtables.sys.arpnat.status=disabled\nebtables.sys.arpnat.1.status=enabled\nebtables.sys.arpnat.1.devname=ath0\n\nebtables.sys.eap.status=disabled\nebtables.sys.eap.1.status=enabled\nebtables.sys.eap.1.devname=ath0\n\n3g.status=enabled\n3g.1.status=enabled\n",airfiber:"netmode=airfiber\n\nbridge.1.devname=br0\nbridge.1.fd=1\nbridge.1.port.1.devname=eth0\nbridge.1.port.1.status=enabled\nbridge.1.port.2.devname=air0\nbridge.1.port.2.status=disabled\nbridge.1.status=enabled\nbridge.1.stp.status=disabled\nbridge.status=enabled\n\nnetconf.1.allmulti=disabled\nnetconf.1.autoip.status=disabled\nnetconf.1.devname=eth0\nnetconf.1.hwaddr.mac=\nnetconf.1.hwaddr.status=disabled\nnetconf.1.ip=0.0.0.0\nnetconf.1.mtu=1500\nnetconf.1.autoneg=enabled\nnetconf.1.netmask=255.255.255.0\nnetconf.1.promisc=enabled\nnetconf.1.role=bridge_port\nnetconf.1.status=enabled\nnetconf.1.up=enabled\n\nnetconf.2.allmulti=disabled\nnetconf.2.autoip.status=disabled\nnetconf.2.devname=air0\nnetconf.2.hwaddr.mac=\nnetconf.2.hwaddr.status=disabled\nnetconf.2.ip=0.0.0.0\nnetconf.2.mtu=1500\nnetconf.2.netmask=255.255.255.0\nnetconf.2.promisc=enabled\nnetconf.2.role=bridge_port\nnetconf.2.status=enabled\nnetconf.2.up=disabled\n\nnetconf.3.allmulti=disabled\nnetconf.3.autoip.status=disabled\nnetconf.3.devname=br0\nnetconf.3.hwaddr.mac=\nnetconf.3.hwaddr.status=disabled\nnetconf.3.ip=192.168.1.20\nnetconf.3.mtu=1500\nnetconf.3.netmask=255.255.255.0\nnetconf.3.role=mlan\nnetconf.3.status=enabled\nnetconf.3.up=enabled\n\nroute.1.comment=\nroute.1.devname=br0\nroute.1.gateway=192.168.1.1\nroute.1.ip=0.0.0.0\nroute.1.netmask=0\nroute.1.status=enabled\nroute.status=enabled\n\nebtables.status=disabled\nebtables.sys.status=disabled\n\nebtables.sys.arpnat.status=disabled\nebtables.sys.eap.status=disabled\n\n"}})();