var reload_timeout=0;function refreshStatus(b,c,a){if(b==null){return handleError(a,c,null)}setOperationMode(b);update_basic(b);update_misc(b);update_ifinfo(b);if(global.has_gps){update_gps(b)}}function handleError(b,c,a){if(b&&b.status!=200&&b.status!=0){window.location.reload()}}function reloadStatus(){$.ajax({url:"status.cgi",cache:false,dataType:"json",success:refreshStatus,error:handleError,complete:function(b,a){if(reload_timeout){clearTimeout(reload_timeout)}reload_timeout=setTimeout(reloadStatus,2000)}});return false}function getIface(a,b){var c=$.grep(a.interfaces,function(d){return d.ifname==b});return c.length>0?c[0]:null}function setOperationMode(j){var c=j.wireless;var d=j.airview;var h=j.host.netrole;var f=j.services;var b=j.firewall;var g=(c.mode=="ap");var a=getModeString(g);var e;if(d.enabled==1){old_mode_string=a;a=l10n_get("Spectral Analyzer");if(d.status.active_connections>0){e=l10n_get("Active")+" - "+d.status.active_connections+" "+l10n_get("clients")}else{if(d.watchdog.seconds_to_exit>0){e=l10n_get("Idle for")+" "+d.watchdog.seconds_idle+l10n_get("s")+".  "+l10n_get("Back to")+" "+old_mode_string+" "+l10n_get("in")+" "+d.watchdog.seconds_to_exit+l10n_get("s")}else{e=l10n_get("Switching back to")+" "+old_mode_string}}}else{e=""}$("#netmode").text(l10n_lang.AirFiber);$("#wmode").text(a);$("#astatus").text(e);$("#astatusinfo").toggle(e!="");$(".disabledmonitor").toggle(false);$(".gpsinfo").toggle(global.has_gps&&j.gps.status!=0);$(".satelites").toggle(false)}function refreshContent(a,b){reloadStatus();if(a.indexOf("?")>0){a=a+"&id="}else{a=a+"?id="}$("#extraFrame").load(a+(new Date().getTime()),b,function(d,c,e){if(e&&e.status!=200&&e.status!=0){window.location.reload();return}$.ready()});return false}function format_rate(a){return parseInt(a)>0?""+a+" Mbps":"-"}function format_ccq(a){return parseInt(a)>0?""+a+" %":"-"}function strip_fwversion(c){if(c.indexOf("-")>0){var a=c.split(".");if(a.length>3){var b="";for(i=0;i<a.length-3;i++){b+=a[i]+"."}b+=a[i];return b}}return c}function addCommas(b){b+="";x=b.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var a=/(\d+)(\d{3})/;while(a.test(x1)){x1=x1.replace(a,"$1,$2")}return x1+x2}function update_basic(d){var f=d.host;var a=d.wireless;var h=""+a.distance;var c=""+d.airfiber.duplex;var e=""+d.airfiber.tx_frequency;var g=""+d.airfiber.rx_frequency;var b=""+d.airfiber.rxgain;$("#signalinfo .switchable").toggle(a.rstatus==5);updateAirFiberSignalLevels(a.rx_chainmask,d.airfiber);$("#hostname").text(f.hostname);$("#fwversion").text(strip_fwversion(f.fwversion));$("#linkname").text(a.essid);$("#regdomain").text(l10n_get("regdom-"+d.airfiber.regdomain));$("#rxcapacity").text(""+addCommas(d.airfiber.rxcapacity)+" bps");$("#txcapacity").text(""+addCommas(d.airfiber.txcapacity)+" bps");$("#linkmode").text(l10n_get(d.airfiber.linkmode));$("#linkstate").text(l10n_get("linkstate-"+d.airfiber.linkstate));$("#af_duplex").text(l10n_get("duplex-"+c));$("#tx_frequency").text(""+(parseInt(e)/1000)+" GHz");$("#rx_frequency").text(""+(parseInt(g)/1000)+" GHz");$("#txpowerdisp").text(""+parseInt(d.airfiber.txpower)+" dBm");$("#rxgaindisp").text(d.airfiber.rxgain);$("#speed").text(l10n_get("speed-"+d.airfiber.txmodrate));$("#remote_speed").text(l10n_get("speed-"+d.airfiber.remote_txmodrate));$("#distance").html(addCommas(h)+"&nbsp;m&nbsp;("+addCommas(Math.round(3.2808399*h))+"&nbsp;ft)");$("#remote_txpower").text(""+parseInt(d.airfiber.remote_txpower)+" dBm");if(a.rstatus==5&&d.airfiber.remote_txpower!="--"&&d.airfiber.remote_txpower!="n/a"){$("#remote_txpower_row").show()}else{$("#remote_txpower_row").hide()}$("#remote_rxgain").text(d.airfiber.remote_rxgain);if(a.rstatus==5&&d.airfiber.remote_rxgain!="--"&&d.airfiber.remote_rxgain!="n/a"){$("#remote_rxgain_row").show()}else{$("#remote_rxgain_row").hide()}if(a.rstatus==5&&d.airfiber.remote_txmodrate!="--"&&d.airfiber.remote_txmodrate!="n/a"){$("#remote_speedinfo").show()}else{$("#remote_speedinfo").hide()}}function update_misc(b){$("#security").text(l10n_get("security-"+b.wireless.security));var a=secsToCountdown(b.host.uptime,l10n_get("day"),l10n_get("days"));$("#uptime").text(a);$("#date").text(b.host.time);if(b.genuine&&b.genuine.length){$("#logo_img").attr("src",b.genuine);$("#logo_info").show()}else{$("#logo_info").hide()}}function get_eth_str(b){if(b&&b.plugged!=0){if(b.speed>0){var a=""+b.speed+"Mbps";if(b.duplex==1){a+="-"+l10n_get("Full")}else{if(b.duplex==0){a+="-"+l10n_get("Half")}}return a}else{return l10n_get("Plugged")}}else{return l10n_get("Unplugged")}}function add_ifinfo(a,b){var c=[];c.push('<div class="row">');c.push('<span class="label">'+a+"</span>");c.push('<span class="value">'+b+"</span>");c.push("</div");$("#ifinfo").append(c.join(""))}function update_ifinfo(b){$("#ifinfo").empty();var d=$.grep(b.interfaces,function(e){return e.ifname.indexOf("eth")==0});$.each(d,function(e,f){add_ifinfo(devname2uidevname(f.ifname)+" MAC:",f.hwaddr)});var a,c;a=devname2uidevname("eth0")+":";c=l10n_get("cpstat-"+get_eth_str(d[0].status));add_ifinfo(a,c);a=devname2uidevname("af0")+":";c=l10n_get("dpstat-"+b.airfiber.data_speed);add_ifinfo(a,c)}function showAction(a){if(a.value==""){return}openPage(a.value,700,200);a.selectedIndex=0}function getModeString(b){var a=l10n_get("airFiber");return a}function get_gps_quality(b){if(b.gps.fix==0){return 0}var c=[[20,10],[15,20],[10,30],[7,40],[5,50],[3.5,60],[2,70],[1.5,80],[1,90],[0,100]];for(var a in c){if(b.gps.dop>c[a][0]){return c[a][1]}}return 0}function update_gps(c){$(".gpsinfo").toggle(c.gps.status!=0);$(".satelites").toggle(false);if(c.gps.status!=0){$("#gps_status").text(l10n_get("Enabled"));var e=get_gps_quality(c);$("#gps_qual").text(e);update_meter("gpsbar",e,100);var d=(c.gps.fix!=0)?'<a target="_blank" href=http://maps.google.com/maps?q='+c.gps.lat+","+c.gps.lon+">"+c.gps.lat+" / "+c.gps.lon+"</a>":"- / -";$("#gps_coord").html(d);var a=(c.gps.fix!=0)?(""+addCommas(Math.round(c.gps.alt))+"&nbsp;m&nbsp;("+addCommas(Math.round(3.2808399*c.gps.alt))+"&nbsp;ft)"):"-";$("#gps_alt").html(a);var b=(c.airfiber.gps_sync!=0)?"Enabled":"Disabled";$("#gps_sync").text(b)}else{$("#gps_status").text(l10n_get("Disabled"))}};